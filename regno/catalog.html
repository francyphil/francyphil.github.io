<!doctype html>
<html lang="it">
  <head>
    <link rel="stylesheet" href="/common-bg.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catalogo Regno</title>
    <script src="/favicon-loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/navbar/navbar.css" />
    <link rel="stylesheet" href="/breadcrumb/breadcrumb.css" />
    <link rel="stylesheet" href="/catalog.css" />
  </head>
  <body>
    <script src="/navbar/navbar.js"></script>
    <div id="breadcrumbContainer"></div>
    <script src="/breadcrumb/breadcrumb.js"></script>

    <div class="content-container">
      <h1></h1>

    <!-- Mobile: filter toggle + panel + compact list -->
    <button id="mobileFilterToggle">
      <span>üîç Filtri <span id="filterBadge" class="filter-badge" style="display:none"></span></span>
      <span class="filter-arrow">‚ñº</span>
    </button>
    <div id="mobileFilterPanel"></div>
    <div id="mobileListContainer"></div>

    <fieldset class="controlli-box">
      <legend>Controlli</legend>
      <div class="controlli-wrapper">
        <label
          >Max record:
          <select id="maxRecords">
            <option value="100">100</option>
            <option value="200">200</option>
            <option value="500">500</option>
            <option value="all">Tutti</option>
          </select>
        </label>
        <label
          >Vista:
          <select id="vistaSelezionata">
            <option value="tabella">Tabella</option>
            <option value="card">Card</option>
            <option value="tabella_card">Tabella + Card</option>
          </select>
        </label>
        <label
          >Schema di catalogazione:
          <select id="schemaCatalogazione">
            <option value="ornaghi_ufficio">Ornaghi Ufficio</option>
            <option value="ornaghi_tipo">Ornaghi Tipo</option>
          </select>
        </label>
      </div>
      <div
        id="loadingIndicator"
        class="loading-indicator"
        style="display: none"
      >
        <div class="spinner"></div>
        <span>Caricamento...</span>
      </div>
    </fieldset>

    <div class="table-wrapper">
      <table id="tabellaFiltri">
        <thead id="theadFiltri">
          <tr id="trTitoli">
            <th class="col-tipo" data-campo="Targhetta Tipo">Tipo</th>
            <th class="col-ufficio" data-campo="Targhetta Ufficio">Ufficio</th>
            <th class="col-extra" data-campo="extra">Extra</th>
            <th class="col-desc" data-campo="Descrizione">Descrizione</th>
            <th class="col-anno" data-campo="Anno">Anno</th>
            <th class="col-localita" data-campo="Localit√†">Localit√†</th>
            <th class="col-denom" data-campo="Denominazione ufficio">Den. Ufficio</th>
            <th class="col-datario" data-campo="Datario">Datario</th>
          </tr>
          <tr id="trFiltri"></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card-container" id="cardContainer"></div>

    <div id="pagination" class="pagination" aria-label="Paginazione"></div>

    <div id="graficoWrapper">
      <canvas id="grafico" height="400"></canvas>
    </div>

    <div id="lightboxOverlay">
      <img id="lightboxImage" />
      <div id="fallbackText"></div>
      <div class="controls">
        <button onclick="prevImage()">‚ü®</button>
        <button onclick="chiudiLightbox()">‚úï</button>
        <button onclick="nextImage()">‚ü©</button>
      </div>
    </div>

    <script>
      var CATALOG_CONFIG = {
        jsonFile: "targhetteRegno.json",
        getImgPath: function(r) {
          return "jpg/prev_" + r["Targhetta Ufficio"] + ((r["extra"]) ? ("_" + (r["extra"]).toString().trim()) : "") + ".jpeg";
        },
        // Regno: link aggiuntivi per Denominazione ufficio e Localit√†
        customCell: function(td, campo, val, r) {
          if (campo === "Denominazione ufficio") {
            var a = document.createElement("a");
            var params = new URLSearchParams({
              denominazione: r["Denominazione ufficio"],
              localita: r["Localit√†"],
            });
            a.href = "ufficioDettaglio.html?" + params.toString();
            a.textContent = val;
            td.appendChild(a);
            return true;
          }
          if (campo === "Localit√†") {
            var a = document.createElement("a");
            var params = new URLSearchParams({
              localita: r["Localit√†"],
            });
            a.href = "cittaDettaglio.html?" + params.toString();
            a.textContent = val;
            td.appendChild(a);
            return true;
          }
          return false;
        }
      };
    </script>
    <script src="/catalog.js"></script>
    </div>

    <link rel="stylesheet" href="/footer/footer.css" />
    <script src="/footer/footer.js"></script>
    <div id="footerContainer"></div>
    <script>
      fetch("/footer/footer.html")
        .then(function(res) { return res.text(); })
        .then(function(html) {
          document.getElementById("footerContainer").innerHTML = html;
        });
    </script>
  </body>
</html>
